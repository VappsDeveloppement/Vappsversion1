{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Utilisateur",
      "type": "object",
      "description": "Représente un utilisateur de la plateforme VApps Success Hub.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identifiant unique de l'utilisateur."
        },
        "firstName": {
          "type": "string",
          "description": "Le prénom de l'utilisateur."
        },
        "lastName": {
          "type": "string",
          "description": "Le nom de famille de l'utilisateur."
        },
        "email": {
          "type": "string",
          "description": "L'adresse e-mail de l'utilisateur.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Le rôle de l'utilisateur (par exemple, client, coach, admin)."
        },
        "dateCreated": {
          "type": "string",
          "description": "La date et l'heure de création du compte utilisateur.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "role",
        "dateCreated"
      ]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Rendez-vous",
      "type": "object",
      "description": "Représente un rendez-vous programmé entre un coach et un client.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identifiant unique du rendez-vous."
        },
        "coachId": {
          "type": "string",
          "description": "Référence à l'Utilisateur (Coach). (Relation : Utilisateur 1:N Rendez-vous)"
        },
        "clientId": {
          "type": "string",
          "description": "Référence à l'Utilisateur (Client). (Relation : Utilisateur 1:N Rendez-vous)"
        },
        "startTime": {
          "type": "string",
          "description": "La date et l'heure de début du rendez-vous.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "La date et l'heure de fin du rendez-vous.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Le statut du rendez-vous (par exemple, programmé, terminé, annulé)."
        },
        "notes": {
          "type": "string",
          "description": "Notes concernant le rendez-vous."
        }
      },
      "required": [
        "id",
        "coachId",
        "clientId",
        "startTime",
        "endTime",
        "status"
      ]
    },
    "EmailCampaign": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CampagneEmail",
      "type": "object",
      "description": "Représente une campagne de marketing par e-mail.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identifiant unique de la campagne e-mail."
        },
        "name": {
          "type": "string",
          "description": "Le nom de la campagne e-mail."
        },
        "subject": {
          "type": "string",
          "description": "La ligne d'objet de la campagne e-mail."
        },
        "body": {
          "type": "string",
          "description": "Le corps HTML de la campagne e-mail."
        },
        "segment": {
          "type": "string",
          "description": "Le segment d'utilisateurs ciblé par cet e-mail."
        },
        "status": {
          "type": "string",
          "description": "Le statut de la campagne e-mail (par exemple, brouillon, planifiée, envoyée)."
        },
        "sentDate": {
          "type": "string",
          "description": "La date et l'heure d'envoi de la campagne e-mail.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "subject",
        "body",
        "segment",
        "status"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Représente un message envoyé entre utilisateurs au sein de la plateforme.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identifiant unique du message."
        },
        "senderId": {
          "type": "string",
          "description": "Référence à l'Utilisateur (Expéditeur). (Relation : Utilisateur 1:N Message)"
        },
        "receiverId": {
          "type": "string",
          "description": "Référence à l'Utilisateur (Destinataire). (Relation : Utilisateur 1:N Message)"
        },
        "content": {
          "type": "string",
          "description": "Le contenu du message."
        },
        "timestamp": {
          "type": "string",
          "description": "La date et l'heure d'envoi du message.",
          "format": "date-time"
        },
        "isRead": {
          "type": "boolean",
          "description": "Indique si le message a été lu par le destinataire."
        }
      },
      "required": [
        "id",
        "senderId",
        "receiverId",
        "content",
        "timestamp",
        "isRead"
      ]
    },
    "Invoice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Facture",
      "type": "object",
      "description": "Représente une facture pour des sessions de coaching ou des services.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identifiant unique de la facture."
        },
        "clientId": {
          "type": "string",
          "description": "Référence à l'Utilisateur (Client). (Relation : Utilisateur 1:N Facture)"
        },
        "issueDate": {
          "type": "string",
          "description": "La date d'émission de la facture.",
          "format": "date-time"
        },
        "dueDate": {
          "type": "string",
          "description": "La date d'échéance de la facture.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Le montant total de la facture."
        },
        "status": {
          "type": "string",
          "description": "Le statut de la facture (par exemple, envoyée, payée, en retard)."
        },
        "paymentDate": {
          "type": "string",
          "description": "La date de paiement de la facture.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "clientId",
        "issueDate",
        "dueDate",
        "amount",
        "status"
      ]
    },
    "Consent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Consentement",
      "type": "object",
      "description": "Représente le consentement d'un utilisateur à la collecte et au traitement des données.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identifiant unique de l'enregistrement de consentement."
        },
        "userId": {
          "type": "string",
          "description": "Référence à l'Utilisateur. (Relation : Utilisateur 1:N Consentement)"
        },
        "consentType": {
          "type": "string",
          "description": "Le type de consentement (par exemple, marketing, traitement des données)."
        },
        "consentGiven": {
          "type": "boolean",
          "description": "Indique si le consentement a été donné."
        },
        "timestamp": {
          "type": "string",
          "description": "La date et l'heure d'enregistrement du consentement.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "consentType",
        "consentGiven",
        "timestamp"
      ]
    },
    "LandingPage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PageDAccueil",
      "type": "object",
      "description": "Représente une page d'accueil personnalisable pour l'application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identifiant unique de la configuration de la page d'accueil."
        },
        "pageName": {
          "type": "string",
          "description": "Nom de la page d'accueil."
        },
        "pageLayout": {
          "type": "string",
          "description": "Structure JSON représentant la mise en page et les composants."
        },
        "lastUpdated": {
          "type": "string",
          "description": "Horodatage de la dernière mise à jour de la page d'accueil.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "pageName",
        "pageLayout",
        "lastUpdated"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stocke les données du profil utilisateur. La propriété basée sur le chemin est appliquée par {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "L'identifiant unique de l'utilisateur."
            }
          ]
        }
      },
      {
        "path": "/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stocke les données des rendez-vous. Inclut 'coachId' et 'clientId' pour un contrôle d'accès direct.",
          "params": [
            {
              "name": "appointmentId",
              "description": "L'identifiant unique du rendez-vous."
            }
          ]
        }
      },
      {
        "path": "/email_campaigns/{emailCampaignId}",
        "definition": {
          "entityName": "EmailCampaign",
          "schema": {
            "$ref": "#/backend/entities/EmailCampaign"
          },
          "description": "Stocke les données des campagnes e-mail.",
          "params": [
            {
              "name": "emailCampaignId",
              "description": "L'identifiant unique de la campagne e-mail."
            }
          ]
        }
      },
      {
        "path": "/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stocke les données des messages. Inclut 'senderId' et 'receiverId' pour le contrôle d'accès.",
          "params": [
            {
              "name": "messageId",
              "description": "L'identifiant unique du message."
            }
          ]
        }
      },
      {
        "path": "/invoices/{invoiceId}",
        "definition": {
          "entityName": "Invoice",
          "schema": {
            "$ref": "#/backend/entities/Invoice"
          },
          "description": "Stocke les données des factures. Inclut 'clientId' pour le contrôle d'accès.",
          "params": [
            {
              "name": "invoiceId",
              "description": "L'identifiant unique de la facture."
            }
          ]
        }
      },
      {
        "path": "/consents/{consentId}",
        "definition": {
          "entityName": "Consent",
          "schema": {
            "$ref": "#/backend/entities/Consent"
          },
          "description": "Stocke les données de consentement. Inclut 'userId' pour la propriété basée sur le chemin.",
          "params": [
            {
              "name": "consentId",
              "description": "L'identifiant unique de l'enregistrement de consentement."
            }
          ]
        }
      },
      {
        "path": "/landing_pages/{landingPageId}",
        "definition": {
          "entityName": "LandingPage",
          "schema": {
            "$ref": "#/backend/entities/LandingPage"
          },
          "description": "Stocke les configurations des pages d'accueil.",
          "params": [
            {
              "name": "landingPageId",
              "description": "L'identifiant unique de la configuration de la page d'accueil."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Indique le rôle d'administrateur pour l'utilisateur. L'existence du document accorde des privilèges d'administrateur. NE PAS stocker de données utilisateur dans ce document - l'existence est l'indicateur.",
          "params": [
            {
              "name": "userId",
              "description": "L'identifiant unique de l'utilisateur."
            }
          ]
        }
      }
    ],
    "reasoning": "La structure Firestore est conçue pour prendre en charge l'application VApps Success Hub, en mettant l'accent sur un contrôle d'accès sécurisé, l'évolutivité et la maintenabilité. La conception adhère aux principes d'indépendance de l'autorisation, de clarté de l'intention, de DBAC (Database-Based Access Control) et de QAP (les règles ne sont pas des filtres).\n\n*   **Indépendance de l'autorisation :** L'autorisation est appliquée à l'aide de la propriété basée sur le chemin et des cartes d'adhésion. Les données appartenant à l'utilisateur (par exemple, Rendez-vous, Consentements, Factures, Messages) sont stockées sous `/users/{userId}`, offrant une propriété claire. Les données collaboratives (par exemple, les ressources partagées) peuvent utiliser des cartes d'adhésion dans les documents si nécessaire. La dénormalisation sera utilisée si nécessaire. Par exemple, la collection `/appointments` inclut `coachId` et `clientId`, permettant des règles de contrôle d'accès direct sans avoir besoin de récupérer les données utilisateur.\n*   **Ségrégation structurelle :** Les données avec des exigences d'accès différentes sont séparées dans des collections différentes. Les profils utilisateur sont stockés sous `/users/{userId}`, les pages d'accueil dans la collection `/landing_pages`, les messages dans `/messages`, les rendez-vous dans `/appointments`, les factures dans `/invoices` et les consentements dans `/consents`. Cette ségrégation simplifie les règles de sécurité en garantissant des besoins d'autorisation cohérents au sein de chaque collection.\n*   **Modélisation de l'accès :** La propriété basée sur le chemin (`/users/{userId}/...`) est utilisée pour les données utilisateur privées. Le modèle de carte d'adhésion (si nécessaire pour les fonctionnalités collaboratives, aucune n'est actuellement spécifiée) impliquerait l'ajout d'un champ `members` aux documents, stockant les ID utilisateur et leurs rôles. Les rôles globaux (par exemple, administrateur) sont gérés via l'existence de documents dans des collections dédiées comme `/roles_admin/{uid}`.\n*   **QAP (Les règles ne sont pas des filtres) :** La structure prend en charge les opérations `list` sécurisées en évitant le besoin de filtrer les données en fonction des rôles ou des autorisations des utilisateurs dans les règles elles-mêmes. Chaque collection est conçue avec des modèles d'accès clairs, permettant aux règles de valider les demandes en fonction du chemin et du statut d'authentification de l'utilisateur, plutôt que d'un filtrage de données complexe.\n\nCette structure favorise des règles de sécurité robustes, simplifie le débogage et garantit l'évolutivité en minimisant les requêtes complexes et la logique d'autorisation."
  }
}

    