

{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the VApps Success Hub platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "agencyId": {
          "type": "string",
          "description": "Reference to the Agency the user belongs to. (Relationship: Agency 1:N User)"
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user (e.g., admin, coach, client, prospect)."
        },
        "dateJoined": {
          "type": "string",
          "description": "The date and time the user joined the platform.",
          "format": "date-time"
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number."
        },
        "address": {
          "type": "string",
          "description": "The user's street address."
        },
        "zipCode": {
          "type": "string",
          "description": "The user's postal code."
        },
        "city": {
          "type": "string",
          "description": "The user's city."
        },
        "socialSecurityNumber": {
          "type": "string",
          "description": "The user's social security number."
        },
        "franceTravailId": {
          "type": "string",
          "description": "The user's France Travail identifier."
        },
        "origin": {
            "type": "string",
            "description": "Source of user creation (e.g., 'Footer Contact Form')."
        },
        "status": {
            "type": "string",
            "enum": ["new", "contacted", "not_interested"],
            "description": "Status for a prospect (e.g., new, contacted)."
        },
        "message": {
          "type": "string",
          "description": "The message sent by the prospect from the contact form."
        },
        "lastSignInTime": {
          "type": "string",
          "format": "date-time",
          "description": "The last time the user signed in, synced from Firebase Auth."
        },
        "gdprReportedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp for when an admin reports an inactivity alert for this user."
        }
      },
      "required": [
        "agencyId",
        "firstName",
        "lastName",
        "email",
        "role",
        "dateJoined",
        "phone"
      ]
    },
    "Agency": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Agency",
      "type": "object",
      "description": "Represents an agency on the platform, containing all personalization settings.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the agency." },
        "name": { "type": "string", "description": "The name of the agency." },
        "personalization": {
          "type": "object",
          "description": "All personalization settings for the agency.",
          "properties": {
            "appTitle": { "type": "string" },
            "appSubtitle": { "type": "string" },
            "logoDataUrl": { "type": "string", "format": "uri" },
            "logoWidth": { "type": "number" },
            "logoHeight": { "type": "number" },
            "logoDisplay": { "type": "string" },
            "primaryColor": { "type": "string" },
            "secondaryColor": { "type": "string" },
            "bgColor": { "type": "string" },
            "footerAboutTitle": { "type": "string" },
            "footerAboutText": { "type": "string" },
            "footerAboutLinks": { "type": "array", "items": { "type": "object" } },
            "footerSocialLinks": { "type": "array", "items": { "type": "object" } },
            "copyrightText": { "type": "string" },
            "copyrightUrl": { "type": "string" },
            "homePageVersion": { "type": "string" },
            "homePageSections": { "type": "array", "items": { "type": "object" } },
            "legalInfo": { "type": "object" }
          }
        }
      },
      "required": ["id", "name"]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents a scheduled appointment between a coach and a client.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the appointment."
        },
        "coachId": {
          "type": "string",
          "description": "Reference to User representing the coach. (Relationship: User 1:N Appointment)"
        },
        "clientId": {
          "type": "string",
          "description": "Reference to User representing the client. (Relationship: User 1:N Appointment)"
        },
        "startTime": {
          "type": "string",
          "description": "The start date and time of the appointment.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end date and time of the appointment.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the appointment (e.g., scheduled, completed, cancelled)."
        },
        "notes": {
          "type": "string",
          "description": "Notes related to the appointment"
        }
      },
      "required": [
        "id",
        "coachId",
        "clientId",
        "startTime",
        "endTime",
        "status"
      ]
    },
    "EmailCampaign": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EmailCampaign",
      "type": "object",
      "description": "Represents an email marketing campaign.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the email campaign."
        },
        "name": {
          "type": "string",
          "description": "The name of the email campaign."
        },
        "subject": {
          "type": "string",
          "description": "The subject line of the email campaign."
        },
        "body": {
          "type": "string",
          "description": "The HTML or plain text body of the email campaign."
        },
        "segment": {
          "type": "string",
          "description": "User segment targeted by the email campaign (e.g., new sign-ups, inactive users)."
        },
        "scheduledTime": {
          "type": "string",
          "description": "The date and time the email campaign is scheduled to be sent.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the email campaign (e.g., draft, scheduled, sent, completed)."
        }
      },
      "required": [
        "id",
        "name",
        "subject",
        "body",
        "segment",
        "scheduledTime",
        "status"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a message sent between users on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the message."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to User who sent the message. (Relationship: User 1:N Message)"
        },
        "recipientId": {
          "type": "string",
          "description": "Reference to User who received the message. (Relationship: User 1:N Message)"
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time the message was sent.",
          "format": "date-time"
        },
        "content": {
          "type": "string",
          "description": "The content of the message."
        },
        "isRead": {
          "type": "boolean",
          "description": "Indicates whether the recipient has read the message."
        }
      },
      "required": [
        "id",
        "senderId",
        "recipientId",
        "timestamp",
        "content",
        "isRead"
      ]
    },
    "Invoice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Invoice",
      "type": "object",
      "description": "Represents an invoice for coaching sessions or other services, generated from an accepted quote.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the invoice." },
        "invoiceNumber": { "type": "string", "description": "The user-facing invoice number." },
        "agencyId": { "type": "string" },
        "clientId": { "type": "string" },
        "clientInfo": { "type": "object", "description": "A snapshot of the client's information." },
        "quoteNumber": { "type": "string", "description": "The number of the original quote." },
        "issueDate": { "type": "string", "format": "date" },
        "dueDate": { "type": "string", "format": "date" },
        "status": { "type": "string", "enum": ["pending", "paid", "overdue", "cancelled"], "description": "The status of the invoice." },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "description": { "type": "string" },
              "quantity": { "type": "number" },
              "unitPrice": { "type": "number" },
              "total": { "type": "number" }
            },
            "required": ["description", "quantity", "unitPrice", "total"]
          }
        },
        "subtotal": { "type": "number" },
        "tax": { "type": "number" },
        "total": { "type": "number" }
      },
      "required": ["id", "invoiceNumber", "agencyId", "clientId", "quoteNumber", "issueDate", "dueDate", "status", "items", "total"]
    },
    "Quote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quote",
      "type": "object",
      "description": "Represents a quote or estimate for services.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the quote." },
        "quoteNumber": { "type": "string", "description": "The user-facing quote number." },
        "validationCode": { "type": "string", "description": "A secret code for the client to validate the quote." },
        "agencyId": { "type": "string" },
        "clientId": { "type": "string" },
        "clientInfo": { "type": "object", "description": "A snapshot of the client's information at the time of quote creation." },
        "agencyInfo": { "type": "object", "description": "A snapshot of the agency's information." },
        "issueDate": { "type": "string", "format": "date" },
        "expiryDate": { "type": "string", "format": "date" },
        "status": { "type": "string", "enum": ["draft", "sent", "accepted", "rejected"], "description": "The status of the quote." },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "description": { "type": "string" },
              "quantity": { "type": "number" },
              "unitPrice": { "type": "number" },
              "total": { "type": "number" }
            },
            "required": ["description", "quantity", "unitPrice", "total"]
          }
        },
        "subtotal": { "type": "number" },
        "tax": { "type": "number" },
        "total": { "type": "number" },
        "notes": { "type": "string" },
        "contractId": { "type": "string", "description": "ID of the attached contract template." },
        "contractTitle": { "type": "string", "description": "Title of the attached contract." },
        "contractContent": { "type": "string", "description": "Snapshot of the contract HTML content." },
        "signature": { "type": "string", "description": "The name entered by the client as a signature." },
        "signedDate": { "type": "string", "format": "date-time", "description": "Timestamp of when the quote was signed." }
      },
      "required": ["id", "quoteNumber", "validationCode", "agencyId", "clientId", "issueDate", "status", "items", "total"]
    },
    "Contract": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Contract",
        "type": "object",
        "description": "Represents a contract template for an agency.",
        "properties": {
            "id": { "type": "string", "description": "Unique identifier for the contract." },
            "agencyId": { "type": "string", "description": "The ID of the agency this contract belongs to." },
            "title": { "type": "string", "description": "The title of the contract template." },
            "content": { "type": "string", "description": "The HTML content of the contract." }
        },
        "required": ["id", "agencyId", "title", "content"]
    },
    "Consent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Consent",
      "type": "object",
      "description": "Represents a user's consent to data processing, in line with GDPR.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the consent record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who provided consent. (Relationship: User 1:N Consent)"
        },
        "consentType": {
          "type": "string",
          "description": "The type of consent (e.g., marketing emails, data sharing)."
        },
        "consentGiven": {
          "type": "boolean",
          "description": "Indicates whether the user has given consent."
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time the consent was given or withdrawn.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "consentType",
        "consentGiven",
        "timestamp"
      ]
    },
    "LandingPage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LandingPage",
      "type": "object",
      "description": "Represents the configuration and content of the landing page.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the landing page configuration."
        },
        "title": {
          "type": "string",
          "description": "The title of the landing page."
        },
        "content": {
          "type": "string",
          "description": "The content of the landing page, stored as HTML or JSON."
        },
        "lastUpdated": {
          "type": "string",
          "description": "The date and time the landing page was last updated.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the landing page (e.g., draft, published)."
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "lastUpdated",
        "status"
      ]
    },
    "Plan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Plan",
      "type": "object",
      "description": "Represents a pricing plan for the agency.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the plan."
        },
        "name": {
          "type": "string",
          "description": "The name of the plan (e.g., 'Essentiel', 'Pro')."
        },
        "description": {
          "type": "string",
          "description": "A short description of the plan."
        },
        "features": {
          "type": "array",
          "items": { "type": "string" },
          "description": "A list of features included in the plan."
        },
        "price": {
          "type": "number",
          "description": "The price of the plan."
        },
        "period": {
          "type": "string",
          "description": "The billing period (e.g., '/mois', '/an')."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image associated with the plan.",
          "format": "uri"
        },
        "appointmentCredits": {
          "type": "number",
          "description": "Number of appointment credits included in the plan."
        },
        "isFeatured": {
          "type": "boolean",
          "description": "Whether the plan should be highlighted as 'featured'."
        },
        "isPublic": {
          "type": "boolean",
          "description": "Whether the plan should be displayed on the public pricing page."
        },
        "agencyId": {
          "type": "string",
          "description": "The ID of the agency this plan belongs to."
        }
      },
      "required": ["id", "name", "price", "period", "agencyId"]
    },
    "GdprRequest": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "GDPR Request",
        "type": "object",
        "description": "Represents a user request related to their personal data.",
        "properties": {
            "id": { "type": "string" },
            "agencyId": { "type": "string" },
            "name": { "type": "string" },
            "email": { "type": "string", "format": "email" },
            "phone": { "type": "string" },
            "subject": { "type": "string" },
            "message": { "type": "string" },
            "status": { "type": "string", "enum": ["new", "in_progress", "closed"] },
            "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "agencyId", "name", "email", "phone", "subject", "message", "status", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/agencies/{agencyId}",
        "definition": {
          "entityName": "Agency",
          "schema": { "$ref": "#/backend/entities/Agency" },
          "description": "Stores agency profiles and their personalization settings. Access is typically restricted to users belonging to that agency."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership enables secure access based on user ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/agencies/{agencyId}/plans/{planId}",
        "definition": {
          "entityName": "Plan",
          "schema": {
            "$ref": "#/backend/entities/Plan"
          },
          "description": "Stores the pricing plans for a specific agency."
        }
      },
      {
        "path": "/agencies/{agencyId}/quotes/{quoteId}",
        "definition": {
          "entityName": "Quote",
          "schema": {
            "$ref": "#/backend/entities/Quote"
          },
          "description": "Stores quotes for a specific agency."
        }
      },
      {
        "path": "/agencies/{agencyId}/contracts/{contractId}",
        "definition": {
          "entityName": "Contract",
          "schema": {
            "$ref": "#/backend/entities/Contract"
          },
          "description": "Stores contract templates for a specific agency."
        }
      },
      {
        "path": "/agencies/{agencyId}/invoices/{invoiceId}",
        "definition": {
          "entityName": "Invoice",
          "schema": {
            "$ref": "#/backend/entities/Invoice"
          },
          "description": "Stores invoices for a specific agency, often generated after a quote is accepted."
        }
      },
       {
        "path": "/gdpr_requests/{requestId}",
        "definition": {
          "entityName": "GdprRequest",
          "schema": { "$ref": "#/backend/entities/GdprRequest" },
          "description": "Stores user requests related to GDPR for tracking and management."
        }
      },
      {
        "path": "/users/{userId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointments for a specific user. Path-based ownership ensures only the user can access their appointments."
        }
      },
      {
        "path": "/users/{userId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores messages for a specific user. Path-based ownership secures message access."
        }
      },
      {
        "path": "/users/{userId}/consents/{consentId}",
        "definition": {
          "entityName": "Consent",
          "schema": {
            "$ref": "#/backend/entities/Consent"
          },
          "description": "Stores consent records for a specific user. Path-based ownership guarantees data privacy."
        }
      },
      {
        "path": "/landing_pages/{landingPageId}",
        "definition": {
          "entityName": "LandingPage",
          "schema": {
            "$ref": "#/backend/entities/LandingPage"
          },
          "description": "Stores landing page configurations. Access controlled by administrator roles."
        }
      },
      {
        "path": "/email_campaigns/{emailCampaignId}",
        "definition": {
          "entityName": "EmailCampaign",
          "schema": {
            "$ref": "#/backend/entities/EmailCampaign"
          },
          "description": "Stores email campaigns. Access controlled by administrator roles."
        }
      }
    ],
    "reasoning": "The Firestore structure is designed for a multi-agency platform. The top-level `agencies` collection stores all personalization and configuration data specific to each agency. The `users` collection now includes an `agencyId` field to link each user to their respective agency. This allows for security rules that grant access to agency data based on the authenticated user's `agencyId`. User-specific data (appointments, messages, etc.) remains nested under each user for strong ownership-based security. New collections for `plans`, `quotes`, `contracts`, and `invoices` are nested under each agency to manage pricing tiers, estimates, legal documents, and billing on a per-agency basis. This structure avoids `get()` calls in security rules by denormalizing the `agencyId` onto the user document, making queries for agency-specific data efficient and secure."
  }
}

